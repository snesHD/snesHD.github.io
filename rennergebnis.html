<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SRN Rennergebnis</title>
  <link rel="stylesheet" href="css/style.css" />
  <script defer src="js/csv-rennergebnis.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script defer>
    document.addEventListener("DOMContentLoaded", function () {
      const saveBtn = document.getElementById("saveTable");
      saveBtn.addEventListener("click", function () {
        const table = document.querySelector(".race-card");
        html2canvas(table).then((canvas) => {
          const link = document.createElement("a");
          link.download = "rennergebnis.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        });
      });

      // Dynamische Seitenleiste aus JSON
      fetch("data/rennen.json")
        .then(res => res.json())
        .then(files => {
          const list = document.getElementById("rennenList");
          files.forEach(file => {
            const li = document.createElement("li");
            const btn = document.createElement("button");
            btn.textContent = file.replace(".csv", "").replaceAll("_", " ");
            btn.onclick = () => ladeCSV(`Ergebnisse/${file}`, file);
            li.appendChild(btn);
            list.appendChild(li);
          });
        });
    });
  </script>
</head>
<body>
  <header>
    <h1>Sim Racing Network - Rennergebnis</h1>
    <p>Platzierungen und Rundenzeiten</p>
  </header>

  <div class="main-layout">
    <aside class="sidebar">
      <h3>Rennen</h3>
      <ul id="rennenList"></ul>
    </aside>

    <div class="container">
      <div class="race-card" id="tableContent">
        <h2 id="rennen-title">Renndaten</h2>
        <table class="results-table race-control-table">
          <thead>
            <tr>
              <th>Pos</th><th>Fahrer</th><th>Team</th><th>Grid</th><th>Stopps</th><th>Beste</th><th>Zeit</th><th>Pkt</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="8">Bitte Rennen wÃ¤hlen...</td></tr>
          </tbody>
        </table>
      </div>
      <div style="margin-top: 1rem; text-align: right;">
        <button id="saveTable">ðŸ“¸ Als PNG speichern</button>
      </div>
    </div>
  </div>
</body>
</html>
